---
title: 如何编写好的软件设计文档
date: '2022-07-02'
tags: ['document', 'design']
draft: false
summary: 'Learn how to define requirements and keep all stakeholders aligned'
authors: ['Wang Lei']
---

<TOCInline toc={props.toc} asDisclosure />

## 为什么要编写设计文档

设计文档（也是设计规范): 主要是对计划如何解决问题的描述。
同时，设计文档也是确保是完成正确工作的工具之一（头脑风暴之类的讨论也是一部分）。
设计文档主要目标是通过思考、设计和收集团队小伙伴等人的反馈来提高设计的正确性和效率。
虽热大家通常认为设计文档的目的是向其他人介绍某些系统或作为以后的参考文档（留档）。
许多小型的项目也可以写设计文档来保持对于程序的理解。

## 设计文档应该包含哪些内容

设计文档描述了问题的解决方案。但是由于问题面对的领域不同，所以需要用不同的方式构建
设计文档。

### 标题和相关人员

- 设计文档的标题

  设计的目标是什么（比如：[CEP-15: General Purpose Transactions](https://cwiki.apache.org/confluence/display/CASSANDRA/CEP-15%3A+General+Purpose+Transactions)）

- 作者和相关人员

  设计文档的作者，计划从事此项目的人员列表

- 文档的审阅者

  文档审阅者，审阅文档设计的问题（比如：鲁棒性等）

- 文档的创建日期和更新日期

  文档在什么时间创建的，和最新一次的更新时间

- 文档的状态

  进行中（In progress), 起草阶段（draft），已完成（complete）等

### 概述

团队成员应该通过阅读概述来决定这个设计是否有阅读和理解的必要, 以及了解和自己（团队成员）的工作的关联程度，最多为3段

### 语境（context）

描述这个问题，为什么需要这个项目，需要知道哪些知识来评估这个项目，
以及它如何适应团队的战略（技术战略，产品战略等）

### 目标

- 基于用户驱动来来描述项目产生的影响，用户可能是另一个工程团队甚至是另一个技术系统
- 确定衡量目标达成的指标（如何QPS，PV， UV等指标), 可以的话提供一个可以追踪这些指标情况的仪表盘（dashboard）

对于不会解决问题的描述也重要，表述在这个设计中不会解决的问题

### 里程碑（Milestones）

可衡量的检查点的列表，提供项目经理等浏览并了解项目的不同部分何时完成。如果项目超过一个月需要确定一下目标（用户侧）的优先级。
比如：

```text
Start Date： July 2, 2022
Milestone 1 - CDC pipeline build: July 20, 2022
Milestone 2 - Migrate data to new system: July 31, 2022
End Date: Add feature X to new system: August 10, 2022
```

如果里程碑的预计到达时间（ETA：Estimated Time of Arrival）发生了变化，添加一个`[update]`的小节提供给项目相关的人员查看和重新估计

### 现有的解决方案（Existing Solution）

除了描述一个当前的实现之外，还应该通过流程示例图来说明用户如何与该系统交互（或者数据流/控制流如何流转的）。


用户故事（user story）是一个很好的框架，系统可能具有不同用例的不同用户

### 建议的解决方案（Proposed Solution）/技术架构

可以尝试通过用户故事来具化解决方案的目标，尽量（随意）添加子部分和图表。

先提供一个大的方向图，然后填写更多细节。确保其他的工程师可以理解它并按照描述的那样实施解决方案。

### 替代的解决方案 （Alternative Solutions）

提出上面的解决方案的时候，考虑了哪些问题。替代方案的优缺点是什么，是否考虑第三方的解决方案（开源或者商业）来解决问题，
而不是自己构建。


### 可测试性，监控和警报（Testability, Monitoring and Alerting）

程序如何测试，监控指标和警报的阈值等。这里需要提供足够的边界测试，端到端测试，单元测试。
这里说一点所有这些都是确保在程序失败的时候提供追踪的方法和路径（即使是flaky test），也是确定软件的边界/系统边界。

### 跨团队影响

- 如何增加人力（on call）和 dev-ops 的负担
- 需要多少钱
- 是否会导致系统出现性能和延迟问题（latency regression）
- 暴露了安全漏洞吗, 哪些漏洞和漏洞等级
- 有哪些负面后果和副作用
- 支持（support）团队如何将需要用户承担的风险告知

### 开放式问题（known unknowns）

任何不确定的未解决的问题，希望成员（读者）参与的有争议的决定、建议的未来工作等。


### 详细的范围和时间表

这部分主要提供给技术主管和项目经理阅读。
尽量细分每个部分的完成的方式和时间。
也可以当作正在进行的项目任务追踪器，当范围估计发生变化的时候需要及时更新

## 怎么写

### 尽可能简单地写

文档的目标是描述你的解决方案并从队友哪里获得反馈。

- 简单的话
- 短句
- 项目符号列表/编号列表
- 具体示例

### 添加大量的图表

图表更容易理解和分析，提供横向和纵向的对比。可以在截图的下方添加可以编辑版本的图表链接，
以便以后在不可避免地发生变化时更新

### 数据（numbers）

问题的规模往往决定了解决方案。为了帮助审阅者了解项目情况，可以包含一些具体的真实数字：数据库行数，延迟，算法复杂度等。

### 试着用搞笑的方法（Try to be funny）

大家都喜欢阅读有趣的东西，所以这是保持阅读的人参与和感兴趣的方法。但是不要过度以免偏离主题思想

### 做怀疑者测试（Do the Skeptic Test）

将文档发送给其他人进行审阅之前，假装自己就是审阅者，对设计会有什么疑问，可以提前解决或者说明。

### 做假期测试

如果在没有互联网访问的情况下，团队中的某个人可以根据文档并按照设计意图实施吗？
设计文档的主要目标不是知识共享，但这是一种评估清晰度的好方法，以便其他人可以为你提供
有用的反馈。

## 过程（Process）

设计文档可以帮助避免浪费大量的时间实施错误的解决方案（错误问题）之前获得反馈。


首先，从事项目的每个人（项目中的所有成员）都应该是设计过程的一部分，每个人都应该参与讨论并接受设计。
设计过程并不意味着白板化的想法，并随意动手制作潜在解决方案的原型。但应该随意编写一些一次性的原型代码
来验证想法，为确保只编写探索性的代码，确保原型代码的中任何一个提交都不会合并到主要分支。


步骤：

1. 请团队中经验丰富的工程师或者技术负责人担任审阅者，理想情况下应该是受团队认可的（或熟悉问题边界的人）
2. 走进一间带白板的会议室
3. 然后解释你想到的实现，并说服他们这是正确的构建


在文档的设计部分提供审阅者（建议者）的名字提供激励。可以增加专门的审查人员（如SRE和安全工程师）

可以在审阅的人确认之后（类似 `Acked-by: wanglei <wanglei4687@gmail.com>`) 这种签名之后留出一周左右
时间用于反馈和收集信息，并承诺在本周内解决其他人提出的建议和问题。

如果你，审阅者和其他工程师产生了大量的争论，可以将争论点合并到文档的讨论部分，然后与各方开会亲自讨论
这些分歧。当评论产生过多的时候，可以考虑面对面沟通（效率更高）。即使每个人都无法达成共识，负责人仍然
有责任做出最终的决定。

## 如何评估设计文档是够成功

如果完成了正确工作的ROI，设计文档就是成功的。一个成功的设计文档可能会导致下面这种结果：

1. 你花了 5 天时间编写设计文档，这迫使你思考技术架构的不同部分
2. 您从审阅者那里获得反馈，`X`是提议的架构中风险最大的部分
3. 您决定首先实施`X`以降低项目风险
4. 3 天后，您发现这`X`要么是不可能的，要么比您最初预期的要困难得多
5. 你决定停止这个项目的工作并优先考虑其他工作

设计文档的目标是确保完成正确的工作。在上面的例子中，感谢这个设计文档，而不是浪费几个月的时间来中止这个项目，你只花了8天。这似乎是一个非常成功的结果。

## 参考

- [How to write a good software design doc](How to write a good software design doc)
